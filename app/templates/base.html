<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ESP32 Live Monitor{% endblock %}</title>
    {% block styles %}{% endblock %}
</head>
<body>

<header style="display:flex; justify-content:flex-end; margin-bottom:20px; gap:10px;">
    <a href="/" id="homeBtn" style="display:none;">–ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
    <a href="/admin" id="adminBtn" style="display:none;">–ê–¥–º—ñ–Ω–∫–∞</a>
    <a href="/login" id="loginBtn">–£–≤—ñ–π—Ç–∏</a>
    <a href="#" id="logoutBtn" class="button-link" style="display:none;">–í–∏–π—Ç–∏</a>
</header>

{% block content %}{% endblock %}

<script>
async function checkAuth() {
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const adminBtn = document.getElementById("adminBtn");
    const homeBtn  = document.getElementById("homeBtn");

    const isAdminPage = window.location.pathname.startsWith("/admin");

    const res = await fetch("/auth/me", {
        credentials: "include"
    });

    if (!res.ok) {
        // ‚ùå –Ω–µ –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–π
        loginBtn.style.display = "inline";
        logoutBtn.style.display = "none";
        adminBtn.style.display = "none";
        homeBtn.style.display = "none";
        return;
    }

    const user = await res.json();

    // ‚úî –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–π
    loginBtn.style.display = "none";
    logoutBtn.style.display = "inline";

    if (user.role === "admin") {
        if (isAdminPage) {
            // üü¢ –≤ –∞–¥–º—ñ–Ω—Ü—ñ ‚Üí –ø–æ–∫–∞–∑–∞—Ç–∏ "–ù–∞ –≥–æ–ª–æ–≤–Ω—É"
            adminBtn.style.display = "none";
            homeBtn.style.display = "inline";
        } else {
            // üü¢ –Ω–µ –≤ –∞–¥–º—ñ–Ω—Ü—ñ ‚Üí –ø–æ–∫–∞–∑–∞—Ç–∏ "–ê–¥–º—ñ–Ω–∫–∞"
            adminBtn.style.display = "inline";
            homeBtn.style.display = "none";
        }
    } else {
        // üë§ –Ω–µ –∞–¥–º—ñ–Ω
        adminBtn.style.display = "none";
        homeBtn.style.display = "none";
    }
}

document.getElementById("logoutBtn")?.addEventListener("click", async () => {
    const res = await fetch("/auth/logout", {
        method: "POST",
        credentials: "include"
    });

    if (res.ok) {
        window.location.href = "/";
    } else {
        alert("–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–π—Ç–∏");
    }
});

checkAuth();
</script>


{% block body_scripts %}{% endblock %}
</body>
</html>
