<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ESP32 Live Monitor{% endblock %}</title>
    {% block styles %}{% endblock %}
</head>
<body>

<header style="display:flex; justify-content:flex-end; margin-bottom:20px; gap:10px;">
    <a href="/" id="homeBtn" style="display:none;">Do strony gÅ‚Ã³wnej</a>
    <a href="/admin" id="adminBtn" style="display:none;">Panel administracyjny</a>
    <a href="/login" id="loginBtn">Zaloguj siÄ™</a>
    <a href="#" id="logoutBtn" class="button-link" style="display:none;">Wyloguj siÄ™</a>
</header>

{% block content %}{% endblock %}

<script>
async function checkAuth() {
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const adminBtn = document.getElementById("adminBtn");
    const homeBtn  = document.getElementById("homeBtn");

    const isAdminPage = window.location.pathname.startsWith("/admin");

    const res = await fetch("/auth/me", {
        credentials: "include"
    });

    if (!res.ok) {
        // âŒ Ð½Ðµ Ð·Ð°Ð»Ð¾Ð³Ñ–Ð½ÐµÐ½Ð¸Ð¹
        loginBtn.style.display = "inline";
        logoutBtn.style.display = "none";
        adminBtn.style.display = "none";
        homeBtn.style.display = "none";
        return;
    }

    const user = await res.json();

    // âœ” Ð·Ð°Ð»Ð¾Ð³Ñ–Ð½ÐµÐ½Ð¸Ð¹
    loginBtn.style.display = "none";
    logoutBtn.style.display = "inline";

    if (user.role === "admin") {
        if (isAdminPage) {
            // ðŸŸ¢ Ð² Ð°Ð´Ð¼Ñ–Ð½Ñ†Ñ– â†’ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ "ÐÐ° Ð³Ð¾Ð»Ð¾Ð²Ð½Ñƒ"
            adminBtn.style.display = "none";
            homeBtn.style.display = "inline";
        } else {
            // ðŸŸ¢ Ð½Ðµ Ð² Ð°Ð´Ð¼Ñ–Ð½Ñ†Ñ– â†’ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸ "ÐÐ´Ð¼Ñ–Ð½ÐºÐ°"
            adminBtn.style.display = "inline";
            homeBtn.style.display = "none";
        }
    } else {
        // ðŸ‘¤ Ð½Ðµ Ð°Ð´Ð¼Ñ–Ð½
        adminBtn.style.display = "none";
        homeBtn.style.display = "none";
    }
}

document.getElementById("logoutBtn")?.addEventListener("click", async () => {
    const res = await fetch("/auth/logout", {
        method: "POST",
        credentials: "include"
    });

    if (res.ok) {
        window.location.href = "/";
    } else {
        alert("Nie udaÅ‚o siÄ™ wylogowaÄ‡");
    }
});

checkAuth();
</script>


{% block body_scripts %}{% endblock %}
</body>
</html>
