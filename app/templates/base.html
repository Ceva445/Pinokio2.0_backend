<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ESP32 Live Monitor{% endblock %}</title>
    {% block styles %}{% endblock %}
</head>
<body>

<header style="display:flex; justify-content:flex-end; margin-bottom:20px; gap:10px;">
    <a href="/login" id="loginBtn">Увійти</a>
    <a href="#" id="logoutBtn" class="button-link" style="display:none;">Вийти</a>
</header>

{% block content %}{% endblock %}

<script>
async function checkAuth() {
    const res = await fetch("/auth/me", {
        credentials: "include" 
    });

    if (res.ok) {
        document.getElementById("loginBtn").style.display = "none";
        document.getElementById("logoutBtn").style.display = "inline";
    }
}

document.getElementById("logoutBtn")?.addEventListener("click", async () => {
    const res = await fetch("/auth/logout", {
        method: "POST",
        credentials: "include"
    });

    if (res.ok) {
        // Redirect to homepage after logout
        window.location.href = "/";
    } else {
        alert("Не вдалося вийти. Спробуйте ще раз.");
    }
});

checkAuth();
</script>

{% block body_scripts %}{% endblock %}
</body>
</html>
